{% extends "base.html" %}

{% block content %}
<div class="wiki-page">
  <div class="container">
    <h1>Балістика Wiki</h1>

    {% if rockets %}
      <p class="intro-text">В нашій базі даних зберігається інформація про наступні типи ракет. 
      Тут ви можете переглянути їх технічні характеристики, параметри удару та інші важливі дані.</p>
      
      <div class="rockets-list">
        {% for rocket in rockets %}
          <div class="rocket-card" id="rocket-{{ rocket.get('Назва', 'unknown').replace(' ', '-').lower() }}">
            <h2 class="rocket-title" onclick="toggleRocketInfo('rocket-details-{{ loop.index }}')">
              {% if rocket.get('Фото') %}
                <img src="{{ rocket.get('Фото') }}" alt="{{ rocket.get('Назва', 'Ракета') }}" class="rocket-thumbnail">
              {% endif %}
              {{ rocket.get('Назва', 'Невідома ракета') }}
              <span class="toggle-icon">▼</span>
            </h2>

            <div id="rocket-details-{{ loop.index }}" class="rocket-details" style="display: none;">
              <div class="rocket-content">
                <div class="rocket-main-info">
                  {% if rocket.get('Опис') %}
                    <div class="rocket-description">
                      <p>{{ rocket.get('Опис') }}</p>
                    </div>
                  {% endif %}

                  <!-- Всі інші пункти, крім специфікованих для таблиці -->
                  {% for key, value in rocket.items() %}
                    {% if key not in ['_id', 'Назва', 'Фото', 'Швидкість м/с', 'Вибухова сила кт', 'Тип', 'Походження', 'На озброєнні (з - до)', 'Оператори', 'Війни', 'Розроблено', 'Виробник', 'Паливо', 'Операційна дальність', 'Точність'] and value %}
                      <div class="info-section">
                        <h3>{{ key }}</h3>
                        <p>{{ value }}</p>
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>
                
                <div class="rocket-sidebar">
                  <div class="rocket-image-container">
                    {% if rocket.get('Фото') %}
                      <img src="{{ rocket.get('Фото') }}" alt="{{ rocket.get('Назва', 'Ракета') }}" class="rocket-img">
                    {% else %}
                      <div class="image-placeholder">Зображення відсутнє</div>
                    {% endif %}
                  </div>
                  
                  <div class="rocket-specs-box">
                    <div class="rocket-specs-title">{{ rocket.get('Назва', 'Невідома ракета') }}</div>
                    
                    <div class="rocket-specs">
                      <!-- Фіксований список категорій для всіх ракет -->
                      {% set spec_fields = [
                        ('Швидкість м/с', ' м/с'),
                        ('Вибухова сила кт', ' кт'),
                        ('Тип', ''),
                        ('Походження', ''),
                        ('На озброєнні (з - до)', ''),
                        ('Оператори', ''),
                        ('Війни', ''),
                        ('Розроблено', ''),
                        ('Виробник', ''),
                        ('Паливо', ''),
                        ('Операційна дальність', ' км'),
                        ('Точність', ' м')
                      ] %}
                      
                      {% for field, unit in spec_fields %}
                        {% if rocket.get(field) %}
                          <div class="specs-row">
                            <div class="specs-label">{{ field.replace('_', ' ') }}:</div>
                            <div class="specs-value">{{ rocket.get(field) }}{{ unit }}</div>
                          </div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="no-data">
        <p>На даний момент інформація про ракети ще не завантажена в систему. Дані будуть з'являтися поступово у процесі оновлення системи.</p>
        <p>Залишайтеся з нами!</p>
      </div>
    {% endif %}
  </div>
</div>

<style>
  .intro-text {
    font-size: 1.1rem;
    margin-bottom: 2rem;
    color: #444;
  }

  .rockets-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .rocket-card {
    background-color: #f9f9f9;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
  }

  .rocket-card:hover {
    transform: translateY(-5px);
  }

  .rocket-title {
    color: #3e5f3e;
    margin-top: 0;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 10px;
    cursor: pointer;
    display: flex;
    justify-content: flex-start;
    align-items: center;
  }

  .rocket-thumbnail {
    width: 40px;
    height: 40px;
    object-fit: contain;
    margin-right: 15px;
    border-radius: 4px;
    border: 1px solid #e0e0e0;
    background-color: #fff;
  }

  .toggle-icon {
    font-size: 0.8em;
    transition: transform 0.3s ease;
    margin-left: auto;
  }

  .rocket-details {
    margin-top: 1rem;
  }

  .rocket-content {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  .rocket-main-info {
    flex: 1 1 calc(100% - 350px);
    min-width: 300px;
    order: 1;
  }

  .rocket-sidebar {
    flex: 0 0 320px;
    max-width: 320px;
    order: 2;
  }

  /* This is the key - ensures content can flow under the sidebar */
  @media (min-width: 769px) {
    .rocket-main-info:after {
      content: "";
      flex: 1000 1 auto;
    }
  }

  .rocket-image-container {
    margin-bottom: 1rem;
    background-color: #f5f5f5;
    border-radius: 8px;
    overflow: hidden;
    text-align: center;
  }

  .rocket-img {
    width: 100%;
    max-height: 250px;
    object-fit: contain;
  }

  .image-placeholder {
    color: #999;
    text-align: center;
    font-style: italic;
    padding: 2rem;
    min-height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .rocket-specs-box {
    background-color: #f0f8f0;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #e0e0e0;
  }

  .rocket-specs-title {
    background-color: #3e5f3e;
    color: white;
    padding: 8px 10px;
    font-weight: bold;
    text-align: center;
  }

  .rocket-specs {
    padding: 15px;
  }

  .specs-row {
    display: flex;
    border-bottom: 1px dotted #ddd;
    padding: 6px 0;
  }

  .specs-row:last-child {
    border-bottom: none;
  }

  .specs-label {
    flex: 0 0 40%;
    font-weight: bold;
    color: #444;
  }

  .specs-value {
    flex: 0 0 60%;
  }

  .rocket-description {
    font-style: italic;
    color: #444;
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }

  .info-section {
    margin-bottom: 1.5rem;
  }

  .info-section h3 {
    color: #3e5f3e;
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
  }

  .no-data {
    background-color: #f0f8f0;
    padding: 2rem;
    border-radius: 10px;
    text-align: center;
    color: #555;
  }

  @media (max-width: 768px) {
    .rocket-content {
      flex-direction: column;
    }

    .rocket-sidebar {
      max-width: 100%;
      order: 1;
    }
    
    .rocket-main-info {
      order: 2;
    }
  }
</style>

<script>
  function toggleRocketInfo(rocketId) {
    const rocketElement = document.getElementById(rocketId);
    const rocketCard = rocketElement.closest('.rocket-card');
    const toggleIcon = rocketCard.querySelector('.toggle-icon');

    if (rocketElement.style.display === 'none') {
      rocketElement.style.display = 'block';
      toggleIcon.style.transform = 'rotate(180deg)';
    } else {
      rocketElement.style.display = 'none';
      toggleIcon.style.transform = 'rotate(0deg)';
    }
  }
</script>
{% endblock %}